---
title: "Titanic ML Disaster"
author: "John Wangui"
date: "`r Sys.Date()`"
output: openintro::lab_report
---

```{r load-packages, message=FALSE}
library(tidyverse)
library(openintro)
```

### Load data

```{r code-chunk-label}

train <- read.csv("~/projects/r/titanic/csv/train.csv")

test <- read.csv("~/projects/r/titanic/csv/test.csv")

# view structure  of the dataframe
str(train)
```

### Show columns for train data frame.

```{r}
# view column for survived.
table(train$Survived)

# view proportion  for passengers who survived.
prop.table(table(train$Survived))
```
### Assume everyone dies in our test dataframe

```{r}
test$Survived <- rep(0, 418)
```

### Extract passengerID and survived from test data and save to CSV.

```{r}
submit <- data.frame(PassengerId = test$PassengerId, Survived = test$Survived)

write.csv(submit, file = "theyallperish.csv", row.names = FALSE)

```

### Look at the gender of the passengers. Women and children were most likely to be saved first. Look at the propotion of survival based on gender. It's evident more women survived.

```{r}
table(train$Sex)

prop.table(table(train$Sex, train$Survived),1)
```
### In the test df we mark women as survivors

```{r}
test$Survived[test$Sex == 'female'] <- 1

all_women_survive <- data.frame(PassengerId = test$PassengerId, Survived = test$Survived)

write.csv(all_women_survive, file = "allwomensurvive.csv", row.names = FALSE)
```

###  let’s start digging into the age variable now

```{r}
summary(train$Age)

train$Child <- 0
train$Child[train$Age < 18] <- 1

aggregate(Survived ~ Child + Sex, data=train, FUN=length)

# Get propotion of survivors
aggregate(Survived ~ Child + Sex, data=train, FUN=function(x) {sum(x)/length(x)})
```


###  let’s look at the fares

Let’s bin the fares into less than $10, between $10 and $20, $20 to $30 and more than $30 and store it to a new variable:

```{r}
train$Fare2 <- '30+'
train$Fare2[train$Fare < 30 & train$Fare >= 20] <- '20-30'
train$Fare2[train$Fare < 20 & train$Fare >= 10] <- '10-20'
train$Fare2[train$Fare < 10] <- '<10'


```

```{r}
aggregate(Survived ~ Fare2 + Pclass + Sex, data=train, FUN=function(x) {sum(x)/length(x)})

```
```{r}
test$Survived <- 0
test$Survived[test$Sex == 'female'] <- 1
test$Survived[test$Sex == 'female' & test$Pclass == 3 & test$Fare >= 20] <- 0


submit <- data.frame(PassengerId = test$PassengerId, Survived = test$Survived)

write.csv(submit, file = "womwen_in_third_class_die.csv", row.names = FALSE)
```

